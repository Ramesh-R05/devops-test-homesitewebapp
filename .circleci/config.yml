# Use the latest 2.1 version of CircleCI pipeline process engine. See: https://circleci.com/docs/2.0/configuration-reference
version: 2.1

# ORBS

orbs:
  welcome: circleci/welcome-orb@0.4.1

# JOBS

jobs:

  job-one:
    machine:
      image: ubuntu-1604:202010-01
    working_directory: ~/homes-site
    steps:
      - checkout
      - run: |
          echo "UBUNTU | NPM | NODEJS"

          echo "### Switching to src dir (/home/circleci/homes-site/src) ### "
          cd src; pwd;

          echo "### Install NVM (Node Version Manager) # Installer for NodeJS + NPM ###"
          curl https://raw.githubusercontent.com/creationix/nvm/master/install.sh | bash
          source ~/.profile

          echo "### Install NVM v10.19.0 ###"
          nvm install v10.19.0

          echo "### Setting Default NVM v10.19.0 ###"
          nvm use v10.19.0;

          echo "### Print Version Information ###"
          echo "Node Version : $(node --version)"
          echo "NPM Version  : $(npm --version)"

          echo "### Setting NPM Registry as BXM ###"
          npm set @bxm:registry http://npm.digital.bauer-media.net.au

          echo "### NPM > Install src/package.json > Node_Rebuild > Node_Test ###"
          npm install
          npm rebuild node-sass --force
          npm run test:ci
          NODE_ENV=production npm run build

# WORKFLOWS

workflows:
  welcome:
    jobs:
      - job-one

### End ###
